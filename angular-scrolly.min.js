/*
 * angular-scrolly - v0.0.4 - 2013-08-13
 * http://github.com/ajoslin/angular-scrolly
 * Created by Andy Joslin; Licensed under Public Domain
 */
angular.module("ajoslin.scrolly",["ajoslin.scrolly.scroller","ajoslin.scrolly.directives"]),angular.module("ajoslin.scrolly.directives",["ajoslin.scrolly.scroller"]).directive("scrollyScroll",["$scroller","$document",function(a){return angular.element(document.body).bind("touchmove",function(a){a.preventDefault()}),{restrict:"A",link:function(b,c){new a(c)}}}]),angular.module("ajoslin.scrolly.desktop",[]).provider("$desktopScroller",function(){var a={38:150,40:-150,32:-600};this.key=function(b,c){return arguments.length>1&&(a[b]=c),a[b]};var b=.5;this.mouseWheelDistanceMulti=function(a){return arguments.length&&(b=a),b},this.$get=["$document",function(c){function d(b,f){function g(a){var b=a.wheelDeltaY*d.mouseWheelDistanceMulti;f.calculateHeight();var c=f.transformer.pos+b;f.transformer.setTo(e(-f.scrollHeight,c,0)),a.preventDefault()}function h(b){if(!(document.activeElement&&document.activeElement.tagName&&document.activeElement.tagName.match(j))){var c=a[b.keyCode||b.which];if(c){if(b.preventDefault(),f.transformer.changing)return;f.calculateHeight();var g=f.transformer.pos+c;if(g=e(-f.scrollHeight,g,0),g!==f.transformer.pos){var h=g-f.transformer.pos,i=Math.abs(h*d.easeTimeMulti);f.transformer.easeTo(g,i)}}}}var i={};b.bind("$destroy",function(){c.unbind("mousewheel",g),c.unbind("keydown",h)}),c.bind("mousewheel",g),c.bind("keydown",h);var j=/INPUT|TEXTAREA|SELECT/i;return i}function e(a,b,c){return Math.min(Math.max(a,b),c)}return d.mouseWheelDistanceMulti=b,d.easeTimeMulti=.66,d}]}),angular.module("ajoslin.scrolly.dragger",[]).provider("$dragger",function(){function a(a,b){for(;a.parentNode;){if(a.getAttribute&&a.getAttribute(b))return a;a=a.parentNode}return null}var b=!0;this.shouldBlurOnDrag=function(a){return arguments.length&&(b=!!a),b};var c=8;this.minDistanceForDrag=function(a){return arguments.length&&(c=a),c};var d=300;this.maxTimeMotionless=function(a){return arguments.length&&(d=a),d},this.$get=["$window","$document",function(){function e(a){return a.pageX}function f(a){return a.pageY}function g(g,h){function i(a,b){angular.forEach(s,function(c){c(a,b)})}function j(a){r.startPos=r.pos=p(a),r.otherStartPos=r.otherPos=q(a),r.startTime=Date.now(),r.dragging=!0}function k(a){return a&&("INPUT"===a.tagName||"SELECT"===a.tagName||"TEXTAREA"===a.tagName)}function l(c){c=c.originalEvent||c,c.stopPropagation();var d=c.target||c.srcElement,e=c.touches?c.touches[0]:c;a(d,"dragger-ignore")||(b&&k(d)&&document.activeElement&&document.activeElement.blur(),r.moved=!1,r.inactiveDrag=!1,r.delta=0,r.pos=0,r.distance=0,j(e),i({type:"start",startPos:r.startPos,startTime:r.startTime}))}function m(a){if(a=a.originalEvent||a,a.preventDefault(),a.stopPropagation(),r.dragging){var b=a.touches?a.touches[0]:a,e=p(b)-r.pos;if(r.delta=e,r.pos=p(b),r.otherPos=q(b),r.distance=r.pos-r.startPos,r.otherDistance=r.otherPos-r.otherStartPos,!r.moved){if(Math.abs(r.otherDistance)>c)return n(a);if(!(Math.abs(r.distance)>c))return;r.moved=!0}var f=r.lastMoveTime-r.startTime;f>d&&j(b),r.lastMoveTime=a.timeStamp||Date.now(),i({type:"move",startPos:r.startPos,startTime:r.startTime,pos:r.pos,delta:r.delta,distance:r.distance})}}function n(a){if(a=a.originalEvent||a,a.stopPropagation(),r.dragging){r.dragging=!1;var b=Date.now(),c=b-r.startTime,e=b-r.lastMoveTime>d;i({type:"end",startPos:r.startPos,startTime:r.startTime,pos:r.pos,delta:r.delta,distance:r.distance,duration:c,inactiveDrag:e})}}var o={};g[0];var p,q;h=h||{},h.horizontal?(p=e,q=f):(p=f,q=e);var r={startPos:0,startTime:0,pos:0,delta:0,distance:0,lastMoveTime:0,inactiveDrag:!1,dragging:!1},s=[];return g.bind("touchstart",l),g.bind("touchmove",m),g.bind("touchend touchcancel",n),o.addListener=function(a){if(!angular.isFunction(a))throw new Error("Expected callback to be a function, instead got '"+typeof a+'".');s.push(a)},o.removeListener=function(a){if(!angular.isFunction(a))throw new Error("Expected callback to be a function, instead got '"+typeof a+'".');var b=s.indexOf(a);b>-1&&s.splice(b,1)},o}return g}]}),angular.module("ajoslin.scrolly.scroller",["ajoslin.scrolly.dragger","ajoslin.scrolly.transformer","ajoslin.scrolly.desktop"]).provider("$scroller",function(){function a(a){return 0|a}var b=.001;this.decelerationRate=function(a){return arguments.length&&(b=a),b};var c=!0;this.supportDesktop=function(a){return c=!!a};var d=.5;this.pastBoundaryScrollRate=function(a){return arguments.length&&(d=a),d};var e=40;this.bounceBuffer=function(a){return arguments.length&&(e=a),e};var f=200,g=1.5;this.bounceBackMinTime=function(a){return arguments.length&&(f=a),f},this.bounceBackDistanceMulti=function(a){return arguments.length&&(g=a),g},this.$get=["$dragger","$transformer","$window","$document","$desktopScroller",function(d,h,i,j,k){function l(a){return Math.abs(a)*g+f}function m(f){function g(b){switch(b.type){case"start":p.changing&&p.stop(),j.calculateHeight();break;case"move":var c=p.pos+b.delta;j.outOfBounds(c)&&(c=p.pos+a(.5*b.delta)),p.setTo(c);break;case"end":if(j.outOfBounds(p.pos)||b.inactiveDrag)j.checkBoundaries();else{var d=j.momentum(b);d.position!==p.pos&&p.easeTo(d.position,d.time,j.checkBoundaries)}}}var j={},n=f.data("$scrolly.scroller");if(n)return n;f.data("$scrolly.scroller",j);var o=f[0],p=j.transformer=new h(f),q=j.dragger=new d(f);return c&&new k(f,j),j.calculateHeight=function(){var a=m.getContentRect(o),b=i.innerHeight;return j.scrollHeight=a.height<b?0:a.height-b+a.top+a.bottom,j.scrollHeight},j.calculateHeight(),j.outOfBounds=function(a){return a>0?a:a<-j.scrollHeight?a+j.scrollHeight:!1},j.checkBoundaries=function(){j.calculateHeight();var a=j.outOfBounds(p.pos);if(a){var b=a>0?0:-j.scrollHeight;p.easeTo(b,l(a))}},j.momentum=function(c){j.calculateHeight();var d,f=Math.abs(c.distance)/c.duration,g=p.pos+f*f/(2*b)*(c.distance<0?-1:1),h=f/b,i=j.outOfBounds(g);return i&&(i>0?g=Math.min(i,e):0>i&&(g=Math.max(g,-(j.scrollHeight+e))),d=Math.abs(g-p.pos),h=d/f),{position:g,time:a(h)}},q.addListener(g),f.bind("$destroy",function(){q.removeListener(g)}),j}return m.getContentRect=function(a){var b=window.getComputedStyle(a),c=parseInt(b.getPropertyValue("margin-top"),10)+parseInt(b.getPropertyValue("padding-top"),10),d=parseInt(b.getPropertyValue("margin-bottom"),10)+parseInt(b.getPropertyValue("padding-bottom"),10),e=parseInt(b.getPropertyValue("top"),10),f=parseInt(b.getPropertyValue("bottom"),10),g=parseInt(b.getPropertyValue("height"),10);return{top:c+(isNaN(e)?0:e),bottom:d+(isNaN(f)?0:f),height:g}},m}]}),angular.module("ajoslin.scrolly.transformer",[]).factory("$nextFrame",["$window",function(a){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||function(b){return a.setTimeout(b,17)}}]).provider("$transformer",function(){var a="cubic-bezier(0.25, 0.46, 0.45, 0.94)";this.timingFunction=function(b){return arguments.length&&(a=b),a},this.$get=["$window","$nextFrame","$sniffer","$document",function(b,c,d,e){function f(b){return l+" "+b+"ms "+a}function g(a){return"translate3d("+a+"px,0,0)"}function h(a){return"translate3d(0,"+a+"px,0)"}function i(a,d){var e={},i=a.data("$scrolly.transformer");if(i)return i;a.data("$scrolly.transformer",e);var j,l,n=a[0];d=d||{},d.horizontal?(j=g,l=4):(j=h,l=5),e.$$calcPosition=function(){var a=b.getComputedStyle(n),c=(a[k]||"").replace(/[^0-9-.,]/g,"").split(",");return c.length>1?parseInt(c[l],10):0},e.pos=e.$$calcPosition();var o;return e.stop=function(a){o&&(b.clearTimeout(o),o=null),n.style[m]="none",e.pos=e.$$calcPosition(),e.changing=!1,c(function(){e.setTo(e.pos),a&&a()})},e.easeTo=function(a,d,g){function h(){n.style[m]=f(d),e.changing=!0,c(function(){e.setTo(a),o=b.setTimeout(function(){e.stop(),g&&g()},d)})}if(!angular.isNumber(d)||0>d)throw new Error("Expected a positive number for time, got '"+d+"'.");e.changing?e.stop(h):h()},e.setTo=function(a){e.pos=a,n.style[k]=j(a)},e}d.vendorPrefix||angular.isString(e[0].body.style.webkitTransition)&&(d.vendorPrefix="webkit");var j=d.vendorPrefix;j&&"Moz"!==j&&"O"!==j&&(j=j.substring(0,1).toLowerCase()+j.substring(1));var k=j?j+"Transform":"transform",l=j?"-"+j.toLowerCase()+"-transform":"transform",m=j?j+"Transition":"transition";return i.transformProp=k,i.transformPropDash=l,i.transitionProp=m,i}]});