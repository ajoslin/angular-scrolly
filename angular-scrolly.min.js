/*
 * angular-scrolly - v0.0.8 - 2013-10-22
 * http://github.com/ajoslin/angular-scrolly
 * Created by Andy Joslin; Licensed under Public Domain
 */
(function() {
!function(){angular.module("ajoslin.scrolly",["ajoslin.scrolly.scroller","ajoslin.scrolly.directives"]);var a=angular.element,b=angular.noop,c=angular.isDefined,d=angular.copy,e=angular.forEach,f=angular.isString,g=angular.extend;angular.module("ajoslin.scrolly.directives",["ajoslin.scrolly.scroller"]).directive("scrollyScroll",["$scroller","$document",function(b){return a(document.body).bind("touchmove",function(a){a.preventDefault()}),{restrict:"A",link:function(a,c){new b(c)}}}]),angular.module("ajoslin.scrolly.directives").directive("scrollyDraggerIgnore",[function(){return{restrict:"A",controller:b}}]),angular.module("ajoslin.scrolly.desktop",[]).provider("$desktopScroller",[function(){var b={38:150,40:-150,32:-600};this.key=function(a,c){return arguments.length>1&&(b[a]=c),b[a]};var c=.5;this.mouseWheelDistanceMulti=function(a){return arguments.length&&(c=a),c},this.$get=["$document",function(d){function e(c,g){function h(b){var d=b.wheelDeltaY*e.mouseWheelDistanceMulti;if(d)for(var f=a(b.target);f.length;){if(f[0]===c.parent()[0]){i(d),b.preventDefault();break}f=f.parent()}}function i(a){g.calculateHeight();var b=g.transformer.pos.y+a;g.transformer.setTo({y:f(-g.scrollHeight,b,0)})}function j(a){if(!(document.activeElement&&document.activeElement.tagName&&document.activeElement.tagName.match(l))){var c=b[a.keyCode||a.which];if(c){if(a.preventDefault(),g.transformer.changing)return;g.calculateHeight();var d=g.transformer.pos.y+c;if(d=f(-g.scrollHeight,d,0),d!==g.transformer.pos.y){var h=d-g.transformer.pos.y,i=Math.abs(h*e.easeTimeMulti);g.transformer.easeTo({y:d},i)}}}}var k={};c.bind("$destroy",function(){d.unbind("mousewheel",h),d.unbind("keydown",j)}),d.bind("mousewheel",h),d.bind("keydown",j);var l=/INPUT|TEXTAREA|SELECT/i;return k}function f(a,b,c){return Math.min(Math.max(a,b),c)}return e.mouseWheelDistanceMulti=c,e.easeTimeMulti=.66,e}]}]),angular.module("ajoslin.scrolly.dragger",[]).provider("$dragger",[function(){var c=!0;this.shouldBlurOnDrag=function(a){return arguments.length&&(c=!!a),c};var f=40;this.allowedDragAngle=function(a){return arguments.length&&(f=a),f};var h=300;this.maxTimeMotionless=function(a){return arguments.length&&(h=a),h},this.$get=["$window","$document",function(){function i(i,m){function n(b){b=b.originalEvent||b;var d=a(b.target||b.srcElement);if(!d.controller("scrollyDraggerIgnore")){m.stopPropagation&&b.stopPropagation();var e=b.touches?b.touches[0]:b;c&&v(d)&&document.activeElement&&document.activeElement.blur(),w.state=s({x:e.pageX,y:e.pageY}),q("start",!0)}}function o(a){if(a=a.originalEvent||a,w.state.active){a.preventDefault(),m.stopPropagation&&a.stopPropagation();var b=a.touches?a.touches[0]:a;b={x:b.pageX,y:b.pageY};var c=Date.now()-w.state.updatedAt;c>h&&(w.state=s(b)),t(w.state,b);var d=r(b,w.state.origin)%180;w.state.direction=90+f>d&&d>90-f?j:f>d&&d>-f?k:l,q("move")}}function p(a){w.state.active&&(a=a.originalEvent||a,m.stopPropagation&&a.stopPropagation(),w.state.updatedAt=Date.now(),w.state.stopped=w.state.updatedAt-w.state.startedAt>h,q("end",!0),w.state={})}function q(a,b){var c=d(w.state);e(x,function(d,f){(b||!c.direction||c.direction==f||f==l)&&e(d,function(b){b(a,c)})})}function r(a,b){var c=Math.atan2(-(b.y-a.y),b.x-a.x);0>c&&(c+=2*Math.PI);var d=Math.floor(c*(180/Math.PI)-180);return 0>d&&d>-180&&(d=360-Math.abs(d)),Math.abs(d)}function s(a){return{origin:{x:a.x,y:a.y},pos:{x:a.x,y:a.y},distance:{x:0,y:0,magnitude:0},delta:{x:0,y:0,magnitude:0},startedAt:Date.now(),updatedAt:Date.now(),stopped:!1,active:!0}}function t(a,b){a.delta=u(b,a.pos),a.distance=u(b,a.origin),a.pos={x:b.x,y:b.y},a.updatedAt=Date.now()}function u(a,b){var c={x:a.x-b.x,y:a.y-b.y};return c.magnitude=Math.sqrt(c.x*c.x+c.y*c.y),c}function v(a){return a&&("INPUT"===a.tagName||"SELECT"===a.tagName||"TEXTAREA"===a.tagName)}m=g({mouse:!0,touch:!0,stopPropagation:!1},m);var w={};i[0];var x={};x[j]=[],x[k]=[],x[l]=[];var y=i.data("$scrolly.dragger");return y?y:(i.data("$scrolly.dragger",w),w.state={},w.addListener=function(a,c){1===arguments.length&&(c=a,a=l),x[a].push(c||b)},w.removeListener=function(a,b){1===arguments.length&&(b=a,a=l);var c=x[a],d=c&&c.indexOf(b);c&&d>-1&&c.splice(d,1)},m.touch&&(i.bind("touchstart",n),i.bind("touchmove",o),i.bind("touchend touchcancel",p)),m.mouse&&(i.bind("mousedown",n),i.bind("mousemove",o),i.bind("mouseup mouseout",p)),i.bind("$destroy",function(){delete x[j],delete x[k],delete x[l]}),w)}var j=i.DIRECTION_VERTICAL=1,k=i.DIRECTION_HORIZONTAL=2,l=i.DIRECTION_ANY=3;return i}]}]),angular.module("ajoslin.scrolly.scroller",["ajoslin.scrolly.dragger","ajoslin.scrolly.transformer","ajoslin.scrolly.desktop"]).provider("$scroller",[function(){function a(a){return 0|a}var b=.001;this.decelerationRate=function(a){return arguments.length&&(b=a),b};var c=!0;this.supportDesktop=function(a){return c=!!a};var d=.5;this.pastBoundaryScrollRate=function(a){return arguments.length&&(d=a),d};var e=10;this.minDistanceForAcceleration=function(a){return arguments.length&&(e=a),e};var f=40;this.bounceBuffer=function(a){return arguments.length&&(f=a),f};var g=200,h=1.5;this.bounceBackMinTime=function(a){return arguments.length&&(g=a),g},this.bounceBackDistanceMulti=function(a){return arguments.length&&(h=a),h},this.$get=["$dragger","$transformer","$window","$document","$desktopScroller",function(d,i,j,k,l){function m(a){return Math.abs(a)*h+g}function n(g){function h(b,c){switch(b){case"start":q.changing&&q.stop(),k.calculateHeight();break;case"move":var d=q.pos.y+c.delta.y;k.outOfBounds(d)&&(d=q.pos.y+a(.5*c.delta.y)),q.setTo({y:d});break;case"end":if(k.outOfBounds(q.pos.y)||c.stopped)k.checkBoundaries();else if(Math.abs(c.distance.y)>=e){var f=k.momentum(c);f.position!==q.pos.y&&q.easeTo({y:f.position},f.time,k.checkBoundaries)}}}var k={},o=g.data("$scrolly.scroller");if(o)return o;g.data("$scrolly.scroller",k);var p=g[0],q=k.transformer=new i(g),r=k.dragger=new d(g,{touch:!0,mouse:!1});return c&&new l(g,k),r.addListener(d.DIRECTION_VERTICAL,h),g.bind("$destroy",function(){r.removeListener(d.DIRECTION_VERTICAL,h)}),k.calculateHeight=function(){var a=n.getContentRect(p),b=j.innerHeight;return k.scrollHeight=a.height<b?0:a.height-b+a.top+a.bottom,k.scrollHeight},k.calculateHeight(),k.outOfBounds=function(a){return a>0?a:a<-k.scrollHeight?a+k.scrollHeight:!1},k.checkBoundaries=function(){k.calculateHeight();var a=k.outOfBounds(q.pos.y);if(a){var b=a>0?0:-k.scrollHeight;q.easeTo({y:b},m(a))}},k.momentum=function(c){k.calculateHeight();var d,e=Math.abs(c.distance.y)/(c.updatedAt-c.startedAt),g=q.pos.y+e*e/(2*b)*(c.distance.y<0?-1:1),h=e/b,i=k.outOfBounds(g);return i&&(i>0?g=Math.min(i,f):0>i&&(g=Math.max(g,-(k.scrollHeight+f))),d=Math.abs(g-q.pos.y),h=d/e),{position:g,time:a(h)}},k}return n.getContentRect=function(a){var b=window.getComputedStyle(a),c=parseInt(b.getPropertyValue("margin-top"),10)+parseInt(b.getPropertyValue("padding-top"),10),d=parseInt(b.getPropertyValue("margin-bottom"),10)+parseInt(b.getPropertyValue("padding-bottom"),10),e=parseInt(b.getPropertyValue("top"),10),f=parseInt(b.getPropertyValue("bottom"),10),g=parseInt(b.getPropertyValue("height"),10);return{top:c+(isNaN(e)?0:e),bottom:d+(isNaN(f)?0:f),height:g}},n}]}]),angular.module("ajoslin.scrolly.transformer",[]).factory("$nextFrame",["$window",function(a){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||function(b){return a.setTimeout(b,17)}}]).provider("$transformer",[function(){var a="cubic-bezier(0.25, 0.46, 0.45, 0.94)";this.timingFunction=function(b){return arguments.length&&(a=b),a},this.$get=["$window","$nextFrame","$sniffer","$document",function(d,e,g,h){function i(b){return n+" "+b+"ms "+a}function j(a,b){return"translate3d("+(a||0)+"px,"+(b||0)+"px,0)"}function k(a){function f(){g.changing&&g.stop(l)}var g={},h=a[0],k=a.data("$scrolly.transformer");if(k)return k;a.data("$scrolly.transformer",g),a.bind("$destroy",function(){g.pos=null,l=null}),g.pos={x:0,y:0},g.updatePosition=function(){var b=d.getComputedStyle(a[0]),c=(b[m]||"").replace(/[^0-9-.,]/g,"").split(",");return c.length>1&&(g.pos.x=parseInt(c[4],10),g.pos.y=parseInt(c[5],10)),g.pos},g.updatePosition();var l;return a.bind(p,f),g.stop=function(a){h.style[o]="",g.updatePosition(),g.changing=!1,e(function(){g.setTo(g.pos),(a||b)()})},g.easeTo=function(b,c,d){function f(){a.css(o,i(c)),g.changing=!0,l=d,e(function(){g.setTo(b)})}if(!angular.isNumber(c)||0>c)throw new Error("Expected a positive number for time, got '"+c+"'.");g.changing?g.stop(f):f()},g.setTo=function(b){c(b.x)&&(g.pos.x=b.x),c(b.y)&&(g.pos.y=b.y),a.css(m,j(g.pos.x,g.pos.y))},g.clear=function(){a.css(m,""),a.css(o,"")},g}g.vendorPrefix||f(h[0].body.style.webkitTransition)&&(g.vendorPrefix="webkit");var l=g.vendorPrefix;l&&"Moz"!==l&&"O"!==l&&(l=l.substring(0,1).toLowerCase()+l.substring(1));var m=l?l+"Transform":"transform",n=l?"-"+l.toLowerCase()+"-transform":"transform",o=l?l+"Transition":"transition",p=l?l+"TransitionEnd":"transitionend";return k.transformProp=m,k.transformPropDash=n,k.transitionProp=o,k.transitionEndProp=p,k}]}])}();
}());