/*
 * angular-scrolly - v0.0.5 - 2013-09-30
 * http://github.com/ajoslin/angular-scrolly
 * Created by Andy Joslin; Licensed under Public Domain
 */
angular.module("ajoslin.scrolly",["ajoslin.scrolly.scroller","ajoslin.scrolly.directives"]),angular.module("ajoslin.scrolly.directives",["ajoslin.scrolly.scroller"]).directive("scrollyScroll",["$scroller","$document",function(a){return angular.element(document.body).bind("touchmove",function(a){a.preventDefault()}),{restrict:"A",link:function(b,c){new a(c)}}}]),angular.module("ajoslin.scrolly.desktop",[]).provider("$desktopScroller",function(){var a={38:150,40:-150,32:-600};this.key=function(b,c){return arguments.length>1&&(a[b]=c),a[b]};var b=.5;this.mouseWheelDistanceMulti=function(a){return arguments.length&&(b=a),b},this.$get=["$document",function(c){function d(b,f){function g(a){var c=a.wheelDeltaY*d.mouseWheelDistanceMulti;f.calculateHeight();for(var e=angular.element(a.target);e.length;){if(e[0]===b.parent()[0]){h(c),a.preventDefault();break}e=e.parent()}}function h(a){var b=f.transformer.pos.y+a;f.transformer.setTo({x:0,y:e(-f.scrollHeight,b,0)})}function i(b){if(!(document.activeElement&&document.activeElement.tagName&&document.activeElement.tagName.match(k))){var c=a[b.keyCode||b.which];if(c){if(b.preventDefault(),f.transformer.changing)return;f.calculateHeight();var g=f.transformer.pos.y+c;if(g=e(-f.scrollHeight,g,0),g!==f.transformer.pos.y){var h=g-f.transformer.pos.y,i=Math.abs(h*d.easeTimeMulti);f.transformer.easeTo({x:0,y:g},i)}}}}var j={};b.bind("$destroy",function(){c.unbind("mousewheel",g),c.unbind("keydown",i)}),c.bind("mousewheel",g),c.bind("keydown",i);var k=/INPUT|TEXTAREA|SELECT/i;return j}function e(a,b,c){return Math.min(Math.max(a,b),c)}return d.mouseWheelDistanceMulti=b,d.easeTimeMulti=.66,d}]}),angular.module("ajoslin.scrolly.dragger",[]).provider("$dragger",function(){function a(a,b){for(;a.parentNode;){if(a.getAttribute&&a.getAttribute(b))return a;a=a.parentNode}return null}var b=!0;this.shouldBlurOnDrag=function(a){return arguments.length&&(b=!!a),b};var c=40;this.allowedDragAngle=function(a){return arguments.length&&(c=a),c};var d=300;this.maxTimeMotionless=function(a){return arguments.length&&(d=a),d},this.$get=["$window","$document",function(){function e(e,i){function j(c){c=c.originalEvent||c,c.stopPropagation();var d=c.target||c.srcElement,e=c.touches?c.touches[0]:c;a(d,"dragger-ignore")||(b&&r(d)&&document.activeElement&&document.activeElement.blur(),s.state=o({x:e.pageX,y:e.pageY}),m("start"))}function k(a){if(a=a.originalEvent||a,a.preventDefault(),a.stopPropagation(),s.state.active){var b=a.touches?a.touches[0]:a;b={x:b.pageX,y:b.pageY};var e=Date.now()-s.state.updatedAt;e>d&&(s.state=o(b)),p(s.state,b);var j=n(b,s.state.origin)%180;s.state.direction=90+c>j&&j>90-c?f:c>j&&j>-c?g:h,(i===h||i===s.state.direction)&&m("move")}}function l(a){a=a.originalEvent||a,a.stopPropagation(),s.state.active&&(s.state.updatedAt=Date.now(),s.state.stopped=s.state.updatedAt-s.state.startedAt>d,m("end"),s.state={})}function m(a){for(var b=angular.copy(s.state),c=0,d=t.length;d>c;c++)t[c](a,b)}function n(a,b){var c=Math.atan2(-(b.y-a.y),b.x-a.x);0>c&&(c+=2*Math.PI);var d=Math.floor(c*(180/Math.PI)-180);return 0>d&&d>-180&&(d=360-Math.abs(d)),Math.abs(d)}function o(a){return{origin:{x:a.x,y:a.y},pos:{x:a.x,y:a.y},distance:{x:0,y:0,magnitude:0},delta:{x:0,y:0,magnitude:0},startedAt:Date.now(),updatedAt:Date.now(),stopped:!1,active:!0}}function p(a,b){a.delta=q(b,a.pos),a.distance=q(b,a.origin),a.pos={x:b.x,y:b.y},a.updatedAt=Date.now()}function q(a,b){var c={x:a.x-b.x,y:a.y-b.y};return c.magnitude=Math.sqrt(c.x*c.x+c.y*c.y),c}function r(a){return a&&("INPUT"===a.tagName||"SELECT"===a.tagName||"TEXTAREA"===a.tagName)}i=i||f;var s={};e[0];var t=[];return s.state={},e.bind("touchstart",j),e.bind("touchmove",k),e.bind("touchend touchcancel",l),e.bind("$destroy",function(){t.length=0}),s.addListener=function(a){if(!angular.isFunction(a))throw new Error("Expected callback to be a function, instead got '"+typeof a+'".');t.push(a)},s.removeListener=function(a){if(!angular.isFunction(a))throw new Error("Expected callback to be a function, instead got '"+typeof a+'".');var b=t.indexOf(a);b>-1&&t.splice(b,1)},s}var f=e.DIRECTION_VERTICAL=1,g=e.DIRECTION_HORIZONTAL=2,h=e.DIRECTION_ANY=3;return e}]}),angular.module("ajoslin.scrolly.scroller",["ajoslin.scrolly.dragger","ajoslin.scrolly.transformer","ajoslin.scrolly.desktop"]).provider("$scroller",function(){function a(a){return 0|a}var b=.001;this.decelerationRate=function(a){return arguments.length&&(b=a),b};var c=!0;this.supportDesktop=function(a){return c=!!a};var d=.5;this.pastBoundaryScrollRate=function(a){return arguments.length&&(d=a),d};var e=10;this.minDistanceForAcceleration=function(a){return arguments.length&&(e=a),e};var f=40;this.bounceBuffer=function(a){return arguments.length&&(f=a),f};var g=200,h=1.5;this.bounceBackMinTime=function(a){return arguments.length&&(g=a),g},this.bounceBackDistanceMulti=function(a){return arguments.length&&(h=a),h},this.$get=["$dragger","$transformer","$window","$document","$desktopScroller",function(d,i,j,k,l){function m(a){return Math.abs(a)*h+g}function n(g){function h(b,c){switch(b){case"start":q.changing&&q.stop(),k.calculateHeight();break;case"move":var d=q.pos.y+c.delta.y;k.outOfBounds(d)&&(d=q.pos.y+a(.5*c.delta.y)),q.setTo({x:0,y:d});break;case"end":if(k.outOfBounds(q.pos.y)||c.stopped)k.checkBoundaries();else if(Math.abs(c.distance.y)>=e){var f=k.momentum(c);f.position!==q.pos.y&&q.easeTo({x:0,y:f.position},f.time,k.checkBoundaries)}}}var k={},o=g.data("$scrolly.scroller");if(o)return o;g.data("$scrolly.scroller",k);var p=g[0],q=k.transformer=new i(g),r=k.dragger=new d(g,d.DIRECTION_VERTICAL);return c&&new l(g,k),r.addListener(h),g.bind("$destroy",function(){r.removeListener(h)}),k.calculateHeight=function(){var a=n.getContentRect(p),b=j.innerHeight;return k.scrollHeight=a.height<b?0:a.height-b+a.top+a.bottom,k.scrollHeight},k.calculateHeight(),k.outOfBounds=function(a){return a>0?a:a<-k.scrollHeight?a+k.scrollHeight:!1},k.checkBoundaries=function(){k.calculateHeight();var a=k.outOfBounds(q.pos.y);if(a){var b=a>0?0:-k.scrollHeight;q.easeTo({x:0,y:b},m(a))}},k.momentum=function(c){k.calculateHeight();var d,e=Math.abs(c.distance.y)/(c.updatedAt-c.startedAt),g=q.pos.y+e*e/(2*b)*(c.distance.y<0?-1:1),h=e/b,i=k.outOfBounds(g);return i&&(i>0?g=Math.min(i,f):0>i&&(g=Math.max(g,-(k.scrollHeight+f))),d=Math.abs(g-q.pos.y),h=d/e),{position:g,time:a(h)}},k}return n.getContentRect=function(a){var b=window.getComputedStyle(a),c=parseInt(b.getPropertyValue("margin-top"),10)+parseInt(b.getPropertyValue("padding-top"),10),d=parseInt(b.getPropertyValue("margin-bottom"),10)+parseInt(b.getPropertyValue("padding-bottom"),10),e=parseInt(b.getPropertyValue("top"),10),f=parseInt(b.getPropertyValue("bottom"),10),g=parseInt(b.getPropertyValue("height"),10);return{top:c+(isNaN(e)?0:e),bottom:d+(isNaN(f)?0:f),height:g}},n}]}),angular.module("ajoslin.scrolly.transformer",[]).factory("$nextFrame",["$window",function(a){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||function(b){return a.setTimeout(b,17)}}]).provider("$transformer",function(){var a="cubic-bezier(0.25, 0.46, 0.45, 0.94)";this.timingFunction=function(b){return arguments.length&&(a=b),a},this.$get=["$window","$nextFrame","$sniffer","$document",function(b,c,d,e){function f(b){return k+" "+b+"ms "+a}function g(a,b){return"translate3d("+(a||0)+"px,"+(b||0)+"px,0)"}function h(a){var d={},e=a[0],h=a.data("$scrolly.transformer");if(h)return h;a.data("$scrolly.transformer",d),d.pos={x:0,y:0},d.updatePosition=function(){var a=b.getComputedStyle(e),c=(a[j]||"").replace(/[^0-9-.,]/g,"").split(",");return c.length>1&&(d.pos.x=parseInt(c[4],10),d.pos.y=parseInt(c[5],10)),d.pos},d.updatePosition();var i;return d.stop=function(a){i&&(b.clearTimeout(i),i=null),e.style[l]="none",d.updatePosition(),d.changing=!1,c(function(){d.setTo(d.pos),(a||angular.noop)()})},d.easeTo=function(a,g,h){function j(){e.style[l]=f(g),d.changing=!0,c(function(){d.setTo(a),i=b.setTimeout(function(){d.stop(),(h||angular.noop)()},g)})}if(!angular.isNumber(g)||0>g)throw new Error("Expected a positive number for time, got '"+g+"'.");d.changing?d.stop(j):j()},d.setTo=function(a){d.pos.x=a.x,d.pos.y=a.y,e.style[j]=g(d.pos.x,d.pos.y)},d}d.vendorPrefix||angular.isString(e[0].body.style.webkitTransition)&&(d.vendorPrefix="webkit");var i=d.vendorPrefix;i&&"Moz"!==i&&"O"!==i&&(i=i.substring(0,1).toLowerCase()+i.substring(1));var j=i?i+"Transform":"transform",k=i?"-"+i.toLowerCase()+"-transform":"transform",l=i?i+"Transition":"transition";return h.transformProp=j,h.transformPropDash=k,h.transitionProp=l,h}]});